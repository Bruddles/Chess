function allowDrop(ev){ev.preventDefault()}function drag(ev){ev.dataTransfer.setData("text/html",ev.target.id),colouredCells=higlightMoves(ev)}function drop(ev){ev.preventDefault();var oldPosition=[],newPosition=[],data=ev.dataTransfer.getData("text/html");oldPosition=findPosition(data),newPosition=findArrayCoords(ev.target.id),console.log(data),console.log(oldPosition),console.log(newPosition),console.log(isLegal(ev,data)),isLegal(ev,data)&&(console.log("moving"),ev.target.appendChild(document.getElementById(data)),piecePos[oldPosition[1]][oldPosition[0]]=0,piecePos[newPosition[1]][newPosition[0]]=data,previousMoves.push([data,findCoords(oldPosition),ev.target.id]),socket.emit("newPreviousMoves",{newMoves:previousMoves})),console.log("coloured: "+colouredCells);for(var i=0;i<colouredCells.length;i++)$("#"+findCoords(colouredCells[i])).css("background-color","white")}function isLegal(ev,data){var possibleMoves=[];switch(oldPosition=findPosition(data),newPosition=findArrayCoords(ev.target.id),data.substring(1,2)){case"P":var moveTransforms=[];if(0==previousMoves.length)moveTransforms.push([0,2]);else{for(var piecePreviouslyMoved=[],i=0;i<previousMoves.length;i++)piecePreviouslyMoved.push(previousMoves[i][0]);-1===piecePreviouslyMoved.indexOf(data)&&moveTransforms.push("B"==data.substring(0,1)?[0,-2]:[0,2])}moveTransforms.push("B"==data.substring(0,1)?[0,-1]:[0,1]),possibleMoves=transform(oldPosition,moveTransforms);break;case"R":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([0,i]),moveTransforms.push([0,-i]);possibleMoves=transform(oldPosition,moveTransforms);break;case"N":var moveTransforms=[[1,2],[-1,2],[1,-2],[-1,-2]];possibleMoves=transform(oldPosition,moveTransforms);break;case"B":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([i,i]),moveTransforms.push([i,-i]),moveTransforms.push([-i,i]),moveTransforms.push([-i,-i]);possibleMoves=transform(oldPosition,moveTransforms);break;case"Q":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([i,i]),moveTransforms.push([i,-i]),moveTransforms.push([-i,i]),moveTransforms.push([-i,-i]),moveTransforms.push([0,i]),moveTransforms.push([0,-i]),moveTransforms.push([i,0]),moveTransforms.push([-i,0]);possibleMoves=transform(oldPosition,moveTransforms);break;case"K":var moveTransforms=[[1,0],[1,1],[0,1],[1,-1],[0,1],[-1,-1],[-1,0],[-1,1]];possibleMoves=transform(oldPosition,moveTransforms)}for(var i=0;i<possibleMoves.length;i++)if(possibleMoves[i][0]==newPosition[0]&&possibleMoves[i][1]==newPosition[1])return!0;return!1}function higlightMoves(ev){var position=[],possibleMoves=[];switch(data=ev.target.id,position=findPosition(data),ev.target.className){case"pawn":var moveTransforms=[];if(0==previousMoves.length)moveTransforms.push([0,2]);else{for(var piecePreviouslyMoved=[],i=0;i<previousMoves.length;i++)piecePreviouslyMoved.push(previousMoves[i][0]);-1===piecePreviouslyMoved.indexOf(data)&&moveTransforms.push("B"==data.substring(0,1)?[0,-2]:[0,2])}moveTransforms.push("B"==data.substring(0,1)?[0,-1]:[0,1]),possibleMoves=transform(position,moveTransforms);break;case"rook":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([0,i]),moveTransforms.push([0,-i]);possibleMoves=transform(position,moveTransforms);break;case"knight":var moveTransforms=[[1,2],[-1,2],[1,-2],[-1,-2]];possibleMoves=transform(position,moveTransforms);break;case"bishop":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([i,i]),moveTransforms.push([i,-i]),moveTransforms.push([-i,i]),moveTransforms.push([-i,-i]);possibleMoves=transform(position,moveTransforms);break;case"queen":for(var moveTransforms=[],i=0;8>i;i++)moveTransforms.push([i,i]),moveTransforms.push([i,-i]),moveTransforms.push([-i,i]),moveTransforms.push([-i,-i]),moveTransforms.push([0,i]),moveTransforms.push([0,-i]),moveTransforms.push([i,0]),moveTransforms.push([-i,0]);possibleMoves=transform(position,moveTransforms);break;case"king":var moveTransforms=[[1,0],[1,1],[0,1],[1,-1],[0,1],[-1,-1],[-1,0],[-1,1]];possibleMoves=transform(position,moveTransforms)}console.log("high"+possibleMoves);for(var i=0;i<possibleMoves.length;i++)$("#"+findCoords(possibleMoves[i])).css("background-color","yellow");return possibleMoves}function findPosition(id){for(var position=[],i=0;i<piecePos.length;i++)-1!==piecePos[i].indexOf(id)&&(position.push(piecePos[i].indexOf(id)),position.push(i));return position}function findCoords(position){var coords="";switch(position[0]){case 0:coords="a";break;case 1:coords="b";break;case 2:coords="c";break;case 3:coords="d";break;case 4:coords="e";break;case 5:coords="f";break;case 6:coords="g";break;case 7:coords="h"}return coords+=position[1]+1}function findArrayCoords(position){var coords=[];switch(position.toString().substring(0,1)){case"a":coords.push(0);break;case"b":coords.push(1);break;case"c":coords.push(2);break;case"d":coords.push(3);break;case"e":coords.push(4);break;case"f":coords.push(5);break;case"g":coords.push(6);break;case"h":coords.push(7)}return coords.push(Number(position.toString().substring(1,2))-1),coords}function transform(position,moveTransforms){for(var possibleMoves=[],i=0;i<moveTransforms.length;i++){var move;move=[position[0]+moveTransforms[i][0],position[1]+moveTransforms[i][1]],move[0]>=0&&move[0]<8&&move[1]>=0&&move[1]<8&&possibleMoves.push(move)}return possibleMoves}function updateBoard(){for(var i=0;i<previousMoves.length;i++){var position=findPosition(previousMoves[i][0]),newPosition=findArrayCoords(previousMoves[i][2]);position!==newPosition&&($("#"+previousMoves[i][0]).appendTo("#"+previousMoves[i][2]),piecePos[position[1]][position[0]]=0,piecePos[newPosition[1]][newPosition[0]]=previousMoves[i][0])}}function lockColour(){}var socket=io.connect("http://127.0.0.1:1337/"),app=app||{},previousMoves=[],colouredCells=[],piecePos=[["WR1","WN1","WB1","WK1","WQ1","WB2","WN2","WR2"],["WP1","WP2","WP3","WP4","WP5","WP6","WP7","WP8"],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],["BP1","BP2","BP3","BP4","BP5","BP6","BP7","BP8"],["BR1","BN1","BB1","BK1","BQ1","BB2","BN2","BR2"]];socket.on("connect",function(){socket.emit("joinGame",{gameName:"test"})}),socket.on("sendMoveData",function(newPreviousMoves){previousMoves=newPreviousMoves.newMoves,updateBoard()});